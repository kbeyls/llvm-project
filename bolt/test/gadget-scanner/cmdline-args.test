# This file tests error messages produced on invalid command line arguments.
# It also test expected help messages produced.

# Verify that an error message is provided if an input file is missing or incorrect

RUN: not llvm-bolt-gadget-scanner 2>&1 | FileCheck -check-prefix=NOFILEARG %s
NOFILEARG:       llvm-bolt-gadget-scanner: Not enough positional command line arguments specified!
NOFILEARG-NEXT:  Must specify at least 1 positional argument: See: {{.*}}llvm-bolt-gadget-scanner --help

RUN: not llvm-bolt-gadget-scanner non-existing-file 2>&1 | FileCheck -check-prefix=NONEXISTINGFILEARG %s
NONEXISTINGFILEARG:       gadget-scanner: 'non-existing-file': No such file or directory.

RUN: not llvm-bolt-gadget-scanner %p/Inputs/dummy.txt 2>&1 | FileCheck -check-prefix=NOELFFILEARG %s
NOELFFILEARG:       gadget-scanner: '{{.*}}/Inputs/dummy.txt': The file was not recognized as a valid object file.

RUN: %clang %cflags -Wl,--emit-relocs %p/../Inputs/asm_foo.s %p/../Inputs/asm_main.c -o %t.exe
RUN: llvm-bolt-gadget-scanner %t.exe 2>&1 | FileCheck -check-prefix=VALIDELFFILEARG --allow-empty %s
# Check that there are no BOLT-WARNING or BOLT-ERROR output lines
VALIDELFFILEARG:     BOLT-INFO:
VALIDELFFILEARG-NOT: BOLT-WARNING:
VALIDELFFILEARG-NOT: BOLT-ERROR:

# Verify --help output

RUN: llvm-bolt-gadget-scanner --help 2>&1 | FileCheck -check-prefix=HELP %s

HELP:       OVERVIEW: GadgetScanner
HELP-EMPTY:
HELP-NEXT:  USAGE: llvm-bolt-gadget-scanner [options] <executable>
HELP-EMPTY:
HELP-NEXT:  OPTIONS:
HELP-EMPTY:
HELP-NEXT:  GadgetScanner options:
HELP-EMPTY:
HELP-NEXT:   --scanners=<value> - which gadget scanners to run, default is all
HELP-NEXT:   =pacret - pac-ret
HELP-NEXT:   =all - all
HELP-EMPTY:
HELP-NEXT:  Generic Options:



